{"ast":null,"code":"var _jsxFileName = \"/Users/SvenL/Projekte/node_projects/clubgruen/frontend/src/index.tsx\";\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { ApolloProvider } from '@apollo/react-hooks';\nimport { App } from './App';\nimport { getAccessToken, setAccessToken } from './accessToken';\nimport { ApolloClient } from 'apollo-client';\nimport { InMemoryCache } from 'apollo-cache-inmemory';\nimport { HttpLink } from 'apollo-link-http';\nimport { onError } from 'apollo-link-error';\nimport { ApolloLink, Observable } from 'apollo-link';\nimport { TokenRefreshLink } from 'apollo-link-token-refresh';\nimport jwtDecode from 'jwt-decode';\nconst cache = new InMemoryCache({});\nconst requestLink = new ApolloLink((operation, forward) => new Observable(observer => {\n  let handle;\n  Promise.resolve(operation).then(operation => {\n    const accessToken = getAccessToken();\n\n    if (accessToken) {\n      operation.setContext({\n        headers: {\n          authorization: `bearer ${accessToken}`\n        }\n      });\n    }\n  }).then(() => {\n    handle = forward(operation).subscribe({\n      next: observer.next.bind(observer),\n      error: observer.error.bind(observer),\n      complete: observer.error.bind(observer)\n    });\n  }).catch(observer.error.bind(observer));\n  return () => {\n    if (handle) handle.unsubscribe();\n  };\n}));\nconst client = new ApolloClient({\n  link: ApolloLink.from([new TokenRefreshLink({\n    accessTokenField: \"accessToken\",\n    isTokenValidOrUndefined: () => {\n      const token = getAccessToken();\n\n      if (!token) {\n        return true;\n      }\n\n      try {\n        const {\n          exp\n        } = jwtDecode(token);\n\n        if (Date.now() >= exp * 1000) {\n          return false;\n        } else {\n          return true;\n        }\n      } catch (error) {\n        return false;\n      }\n    },\n    fetchAccessToken: () => {\n      return fetch(\"http://localhost:4000/refresh_token\", {\n        method: \"POST\",\n        credentials: \"include\"\n      });\n    },\n    handleFetch: accessToken => {\n      setAccessToken(accessToken);\n    },\n    handleError: err => {\n      console.warn('Your refresh token is invalid. Try to relogin');\n    }\n  }), onError(({\n    graphQLErrors,\n    networkError\n  }) => {\n    console.log(graphQLErrors);\n    console.log(networkError);\n  }), requestLink, new HttpLink({\n    uri: 'http://localhost:4000/graphql',\n    credentials: 'include'\n  })]),\n  cache\n});\nReactDOM.render(React.createElement(ApolloProvider, {\n  client: client,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 96\n  },\n  __self: this\n}, React.createElement(App, {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 97\n  },\n  __self: this\n})), document.getElementById('root'));","map":{"version":3,"sources":["/Users/SvenL/Projekte/node_projects/clubgruen/frontend/src/index.tsx"],"names":["React","ReactDOM","ApolloProvider","App","getAccessToken","setAccessToken","ApolloClient","InMemoryCache","HttpLink","onError","ApolloLink","Observable","TokenRefreshLink","jwtDecode","cache","requestLink","operation","forward","observer","handle","Promise","resolve","then","accessToken","setContext","headers","authorization","subscribe","next","bind","error","complete","catch","unsubscribe","client","link","from","accessTokenField","isTokenValidOrUndefined","token","exp","Date","now","fetchAccessToken","fetch","method","credentials","handleFetch","handleError","err","console","warn","graphQLErrors","networkError","log","uri","render","document","getElementById"],"mappings":"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","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport {ApolloProvider} from '@apollo/react-hooks'\nimport {App} from './App';\nimport { getAccessToken, setAccessToken } from './accessToken';\nimport { ApolloClient } from 'apollo-client';\nimport { InMemoryCache } from 'apollo-cache-inmemory';\nimport { HttpLink } from 'apollo-link-http';\nimport { onError } from 'apollo-link-error';\nimport { ApolloLink, Observable } from 'apollo-link';\nimport { TokenRefreshLink } from 'apollo-link-token-refresh';\nimport jwtDecode from 'jwt-decode';\n\nconst cache = new InMemoryCache({});\n\n\nconst requestLink = new ApolloLink((operation, forward) =>\n  new Observable(observer => {\n    let handle: any;\n    Promise.resolve(operation)\n      .then((operation) => {\n            const accessToken = getAccessToken();\n            if(accessToken){\n                operation.setContext({\n                    headers: {\n                        authorization: `bearer ${accessToken}`\n                    } \n                })\n            }\n        }).then(() => {\n            handle = forward(operation).subscribe({\n                next: observer.next.bind(observer),\n                error: observer.error.bind(observer),\n                complete: observer.error.bind(observer)\n            })\n        })\n      .catch(observer.error.bind(observer));\n\n    return () => {\n      if (handle) handle.unsubscribe();\n    };\n  })\n);\n\nconst client = new ApolloClient({\n  link: ApolloLink.from([\n    new TokenRefreshLink({\n        accessTokenField: \"accessToken\",\n        isTokenValidOrUndefined: () => {\n            const token = getAccessToken();\n            if(!token){\n                return true; \n            } \n\n            try {\n                const {exp} = jwtDecode(token)\n                if(Date.now() >= exp * 1000){\n                    return false;\n                } else {\n                    return true;\n                }\n                \n            } catch (error) {\n                return false;\n            }\n        },\n\n        fetchAccessToken: () => {\n            return fetch (\"http://localhost:4000/refresh_token\", {\n                method: \"POST\",\n                credentials: \"include\"\n            })\n        },\n        handleFetch: accessToken => {\n            setAccessToken(accessToken);\n        },\n\n        handleError: err => {\n            console.warn('Your refresh token is invalid. Try to relogin');\n        }\n      }),\n    onError(({ graphQLErrors, networkError }) => {\n        console.log(graphQLErrors);\n        console.log(networkError)\n    }),\n    requestLink,\n    new HttpLink({\n        uri: 'http://localhost:4000/graphql',\n        credentials: 'include'\n    })\n  ]),\n  cache\n});\n\nReactDOM.render(\n    <ApolloProvider client={client} >\n        <App />\n    </ApolloProvider>, document.getElementById('root'));\n\n\n"]},"metadata":{},"sourceType":"module"}