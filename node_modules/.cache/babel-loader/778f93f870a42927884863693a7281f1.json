{"ast":null,"code":"import _regeneratorRuntime from\"/Users/SvenL/Projekte/node_projects/clubgruen/frontend/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/SvenL/Projekte/node_projects/clubgruen/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/SvenL/Projekte/node_projects/clubgruen/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useContext,useEffect,useState}from'react';import{useMyBookingQuery,useDeleteBookingMutation,useCreateMyBookingMutation}from'../../../generated/graphql';import{PropertySelectionView}from'./propertyView/PropertySelectionView';import{BookingButton}from'./actions/BookingButton';import{Grid,Typography}from'@material-ui/core';import moment from'moment';import{BookingContext}from'../BookingContext';import{MyBookingArea,BasicContentBox}from'../../pageframe/global/StyledComponents';import{TravelDatesPicker}from'./datasview/TravelDatesPicker';import{SuccessDialog}from'../../pageframe/global/dialogs/SuccessDialog';import{SuccessDialogContent}from'../../pageframe/global/dialogs/SuccessDialogContent';import{sunUmbrella}from'../../pageframe/global/dialogs/DialogIcons';import{ShowMapButton}from'./actions/ShowMapButton';export var MyBooking=function MyBooking(){var _useMyBookingQuery=useMyBookingQuery(),data=_useMyBookingQuery.data,loading=_useMyBookingQuery.loading,error=_useMyBookingQuery.error,refetch=_useMyBookingQuery.refetch;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),show=_useState2[0],setShow=_useState2[1];var _useCreateMyBookingMu=useCreateMyBookingMutation(),_useCreateMyBookingMu2=_slicedToArray(_useCreateMyBookingMu,1),Booking=_useCreateMyBookingMu2[0];var _useDeleteBookingMuta=useDeleteBookingMutation(),_useDeleteBookingMuta2=_slicedToArray(_useDeleteBookingMuta,1),deleteBooking=_useDeleteBookingMuta2[0];var _useContext=useContext(BookingContext),setArrivalDate=_useContext.setArrivalDate,setDepartureDate=_useContext.setDepartureDate,selectedProperty=_useContext.selectedProperty,arrivalDate=_useContext.arrivalDate,departureDate=_useContext.departureDate,isActive=_useContext.isActive,setIsActive=_useContext.setIsActive,setSelectedPropterty=_useContext.setSelectedPropterty;if(loading){console.log(\"laoding\"+loading);}if(error){console.log(\"error\"+error);}function clearBookingView(){setIsActive(false);setArrivalDate(null);setDepartureDate(null);setSelectedPropterty(null);}var setBooking=function setBooking(data){var myBooking=data===null||data===void 0?void 0:data.myBooking;if(myBooking&&myBooking.from&&myBooking.to&&myBooking.property){setArrivalDate(moment(myBooking.from));setDepartureDate(moment(myBooking.to));setSelectedPropterty(myBooking.property);setIsActive(true);}else{clearBookingView();}};var booking=data===null||data===void 0?void 0:data.myBooking;useEffect(function(){if(data){setBooking(data);}},[booking]);var bookingButtonPressed=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log(isActive);if(isActive){deleteBook();}else{createBook();}case 2:case\"end\":return _context.stop();}}},_callee);}));return function bookingButtonPressed(){return _ref.apply(this,arguments);};}();var deleteBook=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var result;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(data&&data.myBooking)){_context2.next=5;break;}_context2.next=3;return deleteBooking({variables:{bookingId:data.myBooking.id}});case 3:result=_context2.sent;if(result){console.log(\"result myBooking\"+result);refetch();clearBookingView();}case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function deleteBook(){return _ref2.apply(this,arguments);};}();var createBook=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var result;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!(selectedProperty&&arrivalDate&&departureDate)){_context3.next=5;break;}_context3.next=3;return Booking({variables:{from:arrivalDate.valueOf(),to:departureDate.valueOf(),propertyId:selectedProperty.id}});case 3:result=_context3.sent;if(result){console.log(result);refetch();setShow(true);setIsActive(true);}case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function createBook(){return _ref3.apply(this,arguments);};}();var closeDialog=function closeDialog(){setShow(false);};return React.createElement(\"div\",{style:{position:\"sticky\",top:0,zIndex:2}},React.createElement(MyBookingArea,{elevation:4},React.createElement(BasicContentBox,null,React.createElement(\"div\",{style:{marginBottom:\"8px\"}},React.createElement(Typography,{variant:\"h4\"},\"Dein n\\xE4chster Ausflug:\")),React.createElement(TravelDatesPicker,{propertyId:selectedProperty===null||selectedProperty===void 0?void 0:selectedProperty.id}),React.createElement(Grid,{container:true,spacing:4,alignItems:\"flex-end\"},React.createElement(Grid,{item:true,xs:12,sm:true},React.createElement(PropertySelectionView,null)),React.createElement(Grid,{item:true},React.createElement(SuccessDialog,{open:show,handleClose:closeDialog,buttonText:\"Los\"},React.createElement(SuccessDialogContent,{title:\"Super\",text:\"Dann kann es bald los gehen...\"},sunUmbrella)),React.createElement(ShowMapButton,null),React.createElement(BookingButton,{aktiveBooking:isActive,disabled:selectedProperty&&arrivalDate&&departureDate?false:true,buttonPressedListener:bookingButtonPressed}))))));};","map":{"version":3,"sources":["/Users/SvenL/Projekte/node_projects/clubgruen/frontend/src/pages/booking/myBooking/MyBooking.tsx"],"names":["React","useContext","useEffect","useState","useMyBookingQuery","useDeleteBookingMutation","useCreateMyBookingMutation","PropertySelectionView","BookingButton","Grid","Typography","moment","BookingContext","MyBookingArea","BasicContentBox","TravelDatesPicker","SuccessDialog","SuccessDialogContent","sunUmbrella","ShowMapButton","MyBooking","data","loading","error","refetch","show","setShow","Booking","deleteBooking","setArrivalDate","setDepartureDate","selectedProperty","arrivalDate","departureDate","isActive","setIsActive","setSelectedPropterty","console","log","clearBookingView","setBooking","myBooking","from","to","property","booking","bookingButtonPressed","deleteBook","createBook","variables","bookingId","id","result","valueOf","propertyId","closeDialog","position","top","zIndex","marginBottom"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useState} from 'react'\nimport { useMyBookingQuery, useDeleteBookingMutation, useCreateMyBookingMutation, MyBookingQuery} from '../../../generated/graphql';\nimport { PropertySelectionView } from './propertyView/PropertySelectionView';\nimport { BookingButton } from './actions/BookingButton';\nimport { Grid, Typography } from '@material-ui/core';\nimport moment from 'moment';\nimport { BookingContext } from '../BookingContext';\nimport { MyBookingArea, BasicContentBox } from '../../pageframe/global/StyledComponents';\nimport { TravelDatesPicker } from './datasview/TravelDatesPicker';\nimport { SuccessDialog } from '../../pageframe/global/dialogs/SuccessDialog';\nimport { SuccessDialogContent } from '../../pageframe/global/dialogs/SuccessDialogContent';\nimport { sunUmbrella } from '../../pageframe/global/dialogs/DialogIcons';\nimport { ShowMapButton } from './actions/ShowMapButton';\n\n\ninterface Props {\n    \n}\n\nexport const MyBooking:  React.FC<Props> = () => {\n\n    const {data, loading, error, refetch} = useMyBookingQuery();\n\n    const [show, setShow] = useState(false);\n\n    const [Booking] = useCreateMyBookingMutation();\n    const [deleteBooking] = useDeleteBookingMutation();\n    const { \n              setArrivalDate, \n              setDepartureDate,\n              selectedProperty,\n              arrivalDate, \n              departureDate,\n              isActive,\n              setIsActive,\n              setSelectedPropterty} = useContext(BookingContext);\n\n    \n    if(loading){\n      console.log(\"laoding\" + loading)\n    }\n\n    if(error){\n      console.log(\"error\" + error) \n    }\n\n    function clearBookingView() {\n      setIsActive(false);\n      setArrivalDate(null);\n      setDepartureDate(null);\n      setSelectedPropterty(null)\n    }\n\n   const setBooking = (data: MyBookingQuery | undefined) => {\n    const myBooking = data?.myBooking;\n    if(myBooking && myBooking.from && myBooking.to && myBooking.property){\n      setArrivalDate(moment(myBooking.from));\n      setDepartureDate(moment(myBooking.to))\n      setSelectedPropterty(myBooking.property)\n      setIsActive(true);\n    } else {\n      clearBookingView()\n    }\n  }\n\n\n\n  const booking = data?.myBooking;\n\n    useEffect(() => {\n      if(data){\n        setBooking(data)\n      }\n        \n    } , [booking]) \n    \n\n    const bookingButtonPressed = async () => {\n      console.log(isActive)\n      if(isActive){\n          deleteBook();     \n      } else{\n          createBook()\n      }\n    }\n\n    const deleteBook = async () => {\n      if(data && data.myBooking){\n        const result = await deleteBooking({\n          variables: {\n            bookingId: data.myBooking.id\n          }\n        })\n        if(result){\n          console.log(\"result myBooking\" + result);\n          refetch();\n          clearBookingView()\n        }\n      } \n    }\n\n    const createBook = async () => {\n      if(selectedProperty && arrivalDate && departureDate){\n        const result = await Booking(\n          { \n            variables: {\n                from: arrivalDate.valueOf(),\n                to: departureDate.valueOf(),\n                propertyId: selectedProperty.id\n            }\n          })\n          if(result){\n\n            console.log(result);\n            refetch();\n            setShow(true)\n            setIsActive(true)\n          }  \n      }\n    }\n\n    const closeDialog = () => {\n        setShow(false)\n    }\n\n    \n    return (\n        <div style={{position: \"sticky\", top: 0, zIndex: 2}}>\n              <MyBookingArea elevation={4}>        \n                <BasicContentBox>\n                  <div style={{marginBottom: \"8px\"}}>\n                  <Typography variant=\"h4\">\n                    Dein nächster Ausflug:\n                    </Typography>\n                    </div>\n                    <TravelDatesPicker propertyId={selectedProperty?.id} />\n                  \n                  <Grid container spacing={4} alignItems=\"flex-end\">\n                    <Grid item xs={12} sm>\n                      <PropertySelectionView />\n                    </Grid>\n                    <Grid item >\n\n\n                      <SuccessDialog \n                          open={show} \n                          handleClose={closeDialog}\n                          buttonText={\"Los\"} \n                          >\n                            <SuccessDialogContent\n                            title={\"Super\"}\n                            text={\"Dann kann es bald los gehen...\"}>\n                              {sunUmbrella}\n\n                            </SuccessDialogContent>\n                          </SuccessDialog>\n                      <ShowMapButton />\n                      <BookingButton \n                          aktiveBooking={isActive} \n                          disabled={selectedProperty && arrivalDate && departureDate? false : true} \n                          buttonPressedListener={bookingButtonPressed}/>\n                    </Grid>\n                  </Grid>\n                  </BasicContentBox>               \n              </MyBookingArea>             \n          </div>\n    )\n    \n}\n"]},"metadata":{},"sourceType":"module"}